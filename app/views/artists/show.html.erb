<% content_for :title, "Artist Profile" %>

<div class="min-vh-100" style="background-color: #f8f9fa;">
  <div class="px-3 pt-4" style="max-width: 500px; margin: 0 auto;">

    <!-- Artist Profile Card -->
    <div class="card border-0 shadow-lg mb-4" style="border-radius: 24px; background-color: #ffffff;">
      <div class="card-body text-center">
        <!-- Profile Image -->
        <% if @artist.image.present? %>
          <img src="<%= url_for(@artist.image) %>" alt="Artist Photo" 
               class="rounded-circle border border-white border-3 mb-3" 
               style="width: 120px; height: 120px; object-fit: cover; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
        <% else %>
          <div class="rounded-circle bg-secondary mb-3 d-flex align-items-center justify-content-center"
               style="width: 120px; height: 120px; color: white;">
            <i class="fas fa-user fa-2x"></i>
          </div>
        <% end %>

        <!-- Display Name -->
        <% if @artist.website.present? %>
          <h4 class="fw-bold mb-2 mt-2 display-6"
    style="background: linear-gradient(90deg, #0d6efd, #4dabf7); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            <% if @artist.website.present? %>
              <%= link_to @artist.username, @artist.website,
                target: "_blank", rel: "noopener",
                class: "text-decoration-none" %>
            <% else %>
              <%= @artist.username %>
            <% end %>
          </h4>
        <% end %>

        <!-- Social Links -->
        <% if @artist.instagram_url.present? || @artist.youtube_url.present? || @artist.tiktok_url.present? || @artist.spotify_url.present? %>
          <div class="d-flex justify-content-center gap-3 mt-3 mb-3 flex-wrap">
            <% if @artist.instagram_url.present? %>
              <%= link_to @artist.instagram_url, target: "_blank", rel: "noopener", class: "text-decoration-none" do %>
                <i class="fab fa-instagram fa-lg" style="color: #E1306C;"></i>
              <% end %>
            <% end %>
            <% if @artist.youtube_url.present? %>
              <%= link_to @artist.youtube_url, target: "_blank", rel: "noopener", class: "text-decoration-none" do %>
                <i class="fab fa-youtube fa-lg" style="color: #FF0000;"></i>
              <% end %>
            <% end %>
            <% if @artist.tiktok_url.present? %>
              <%= link_to @artist.tiktok_url, target: "_blank", rel: "noopener", class: "text-decoration-none" do %>
                <i class="fab fa-tiktok fa-lg" style="color: #000000;"></i>
              <% end %>
            <% end %>
            <% if @artist.spotify_url.present? %>
              <%= link_to @artist.spotify_url, target: "_blank", rel: "noopener", class: "text-decoration-none" do %>
                <i class="fab fa-spotify fa-lg" style="color: #1DB954;"></i>
              <% end %>
            <% end %>
          </div>
        <% end %>

        <!-- Follow/Unfollow Button -->
        <turbo-frame id="follow_button_<%= @artist.id %>">
          <%= render partial: "artists/follow_button", locals: { artist: @artist } %>
        </turbo-frame>

        <!-- Bio -->
        <% if @artist.bio.present? %>
          <p class="mt-3"><%= simple_format(@artist.bio) %></p>
        <% end %>
      </div>
    </div>

    <!-- Upcoming Events -->
    <h5 class="text-center text-muted mb-3">Upcoming Events</h5>
    <% if @upcoming_events.any? %>

      <% @upcoming_events.each do |event| %>
        <div class="card mb-3 shadow-sm border-0 rounded-4" style="background-color: #ffffff;">
          <div class="card-body text-center p-3"
               data-controller="event-card"
               data-event-card-url-value="<%= event_path(event) %>"
               data-action="click->event-card#goToEvent"
            style="cursor: pointer;">

            <div class="d-inline-block px-3 py-1 rounded-pill bg-light text-dark fw-semibold mb-2"
                 style="font-size: 0.9rem;">
              <i class="bi bi-clock me-1"></i>
              <%= event.date.strftime("%A, %b %-d") %> • <%= event.start_time.strftime("%-I:%M %p") %> - <%= event.end_time.strftime("%-I:%M %p") %>
            </div>
            <br>
            <small>
              at <%= link_to event.venue.name, venue_path(event.venue),
                            class: "text-decoration-none",
                            onclick: "event.stopPropagation(); event.stopImmediatePropagation();" %>
            </small>
          </div>
        </div>
      <% end %>
    <% else %>
      <p class="text-muted text-center">No upcoming events.</p>
    <% end %>

    <!-- Past Events -->
    <% if @past_events.any? %>
      <h5 class="text-center text-muted mb-3 mt-5">Past Events</h5>

      <% @past_events.each do |event| %>
        <div class="card mb-3 shadow-sm border-0 rounded-4" style="background-color: #ffffff;">
          <div class="card-body text-center p-3"
           data-controller="event-card"
           data-event-card-url-value="<%= event_path(event) %>"
           data-action="click->event-card#goToEvent"
            style="cursor: pointer;">

            <div class="d-inline-block px-3 py-1 rounded-pill bg-light text-dark fw-semibold mb-2"
             style="font-size: 0.9rem;">
              <i class="bi bi-clock me-1"></i>
              <%= event.date.strftime("%A, %b %-d") %> • <%= event.start_time.strftime("%-I:%M %p") %> - <%= event.end_time.strftime("%-I:%M %p") %>
            </div>
            <br>
            <small>
              at <%= link_to event.venue.name, venue_path(event.venue),
                        class: "text-decoration-none",
                        onclick: "event.stopPropagation(); event.stopImmediatePropagation();" %>
            </small>
          </div>
        </div>
      <% end %>
    <% end %>

  </div>
</div>

<!-- Modal if not signed in -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <p class="mb-3">Sign in or sign up to follow this artist.</p>
        <div class="d-flex justify-content-center gap-2">
          <%= link_to "Sign In", new_user_session_path, class: "btn btn-outline-primary", data: { turbo: false } %>
          <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary", data: { turbo: false } %>
        </div>
      </div>
    </div>
  </div>
</div>
