<div class="container pt-4" style="max-width: 600px;">

  <%= form_with model: event, local: true, class: "needs-validation" do |f| %>

    <!-- Hidden field to set the artist -->
    <%= f.hidden_field :artist_id, value: current_artist.id %>

    <!-- Search or select venue -->
    <div class="mb-3" data-controller="venue-autocomplete">
      <%= label_tag "venue_search", "Search for Venue", class: "form-label" %>
      <%= text_field_tag "venue_search", "",
        placeholder: "Start typing venue name...",
        class: "form-control",
        data: {
          action: "input->venue-autocomplete#search",
          venue_autocomplete_target: "input"
        } %>

      <ul class="list-group mt-1" data-venue-autocomplete-target="results"></ul>

      <%= hidden_field_tag "event[venue_id]", nil, data: { venue_autocomplete_target: "hidden" } %>
    </div>

    <!-- Dropdown fallback -->
    <div class="mb-3">
      <%= f.label :venue_id, "Or Select from Dropdown", class: "form-label" %>
      <%= f.select :venue_id, 
          options_from_collection_for_select(Venue.all, :id, :name), 
          { prompt: "Select a venue" }, 
          { class: "form-select" } %>
    </div>

    <!-- Error block -->
    <% if event.errors[:base].any? %>
      <div class="text-danger small mt-2"><%= event.errors[:base].first %></div>
    <% end %>

    <!-- Category Dropdown -->
    <div class="mb-3">
      <%= f.label :category, class: "form-label" %>
      <%= f.select :category, ["Guitar", "Piano", "Band", "DJ"], {}, class: "form-select", required: true %>
    </div>

    <!-- Description -->
    <div class="mb-3">
      <%= f.label :description, class: "form-label" %>
      <%= f.text_area :description, class: "form-control", placeholder: "Describe the event", rows: 3 %>
    </div>

    <!-- Date Dropdown (Next 14 Days) -->
    <div class="mb-3">
      <%= f.label :date, class: "form-label" %>
      <%= f.select :date,
        (0..13).map { |i|
        date = Date.today + i.days
        [date.strftime("%A, %B %-d"), date.to_s]
        },
        {},
      class: "form-select", required: true %>
    </div>

    <!-- Start Time Dropdown -->
    <div class="mb-3">
      <%= f.label :start_time, "Start Time", class: "form-label" %>
      <%= f.select :start_time, time_options, {}, class: "form-select", required: true %>
    </div>

    <!-- End Time Dropdown -->
    <div class="mb-3">
      <%= f.label :end_time, "End Time", class: "form-label" %>
      <%= f.select :end_time, time_options, {}, class: "form-select", required: true %>
    </div>

    <!-- Cover Checkbox -->
    <div class="form-check mb-3">
      <%= f.check_box :cover, class: "form-check-input" %>
      <%= f.label :cover, "Cover Charge?", class: "form-check-label" %>
    </div>

    <!-- Indoors Checkbox -->
    <div class="form-check mb-4">
      <%= f.check_box :indoors, class: "form-check-input" %>
      <%= f.label :indoors, "Indoors?", class: "form-check-label" %>
    </div>

    <div class="d-grid">
      <%= f.submit "Create Event", class: "btn btn-primary" %>
    </div>

  <% end %>
</div>

  <div>
    <%= link_to "Back to events", artist_dashboard_path(current_artist) %>
  </div>
