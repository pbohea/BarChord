<div class="container mt-5" style="max-width: 600px;">
  <h2 class="mb-4 text-center">Create New Event</h2>

  <%= form_with model: @event, local: true, class: "needs-validation" do |f| %>

    <!-- Venue Dropdown (owned by current_owner) -->
    <div class="mb-3">
      <%= f.label :venue_id, "Venue", class: "form-label" %>
      <%= f.select :venue_id, current_owner.venues.pluck(:name, :id), {}, class: "form-select", required: true %>
    </div>

    <!-- Search or select artist -->
    <div class="mb-3" data-controller="artist-autocomplete">
      <%= label_tag "artist_search", "Search for Artist", class: "form-label" %>
      <%= text_field_tag "artist_search", "",
        placeholder: "Start typing...",
        class: "form-control",
        data: {
          action: "input->artist-autocomplete#search",
          artist_autocomplete_target: "input"
        } %>

      <ul class="list-group mt-1" data-artist-autocomplete-target="results"></ul>

      <%= hidden_field_tag "event[artist_id]", nil, data: { artist_autocomplete_target: "hidden" } %>
    </div>

    <!-- Manual fallback -->
    <div class="mb-3">
      <%= f.label :artist_name, "Or Enter Artist Name", class: "form-label" %>
      <%= f.text_field :artist_name,
        class: "form-control #{'is-invalid' if @event.errors[:artist_name].present?}" %>
    </div>

    <!-- Optional: error block -->
    <% if @event.errors[:base].any? %>
      <div class="text-danger small mt-2"><%= @event.errors[:base].first %></div>
    <% end %>

    <!-- Category Dropdown -->
    <div class="mb-3">
      <%= f.label :category, class: "form-label" %>
      <%= f.select :category, ["Guitar", "Piano", "Band", "DJ"], {}, class: "form-select", required: true %>
    </div>

    <!-- Description -->
    <div class="mb-3">
      <%= f.label :description, class: "form-label" %>
      <%= f.text_area :description, class: "form-control", placeholder: "Describe the event", rows: 3 %>
    </div>

    <!-- Date Dropdown (Next 14 Days) -->
    <div class="mb-3">
      <%= f.label :date, class: "form-label" %>
      <%= f.select :date,
        (0..13).map { |i|
        date = Date.today + i.days
        [date.strftime("%A, %B %-d"), date.to_s]
        },
        {},
      class: "form-select", required: true %>
    </div>

    <!-- Start Time Dropdown -->
    <div class="mb-3">
      <%= f.label :start_time, "Start Time", class: "form-label" %>
      <%= f.select :start_time, time_options, {}, class: "form-select", required: true %>
    </div>

    <!-- End Time Dropdown -->
    <div class="mb-3">
      <%= f.label :end_time, "End Time", class: "form-label" %>
      <%= f.select :end_time, time_options, {}, class: "form-select", required: true %>
    </div>

    <!-- Cover Checkbox -->
    <div class="form-check mb-3">
      <%= f.check_box :cover, class: "form-check-input" %>
      <%= f.label :cover, "Cover Charge?", class: "form-check-label" %>
    </div>

    <!-- Indoors Checkbox -->
    <div class="form-check mb-4">
      <%= f.check_box :indoors, class: "form-check-input" %>
      <%= f.label :indoors, "Indoors?", class: "form-check-label" %>
    </div>

    <div class="d-grid">
      <%= f.submit "Create Event", class: "btn btn-primary" %>
    </div>

  <% end %>
</div>
