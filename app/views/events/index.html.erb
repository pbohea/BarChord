<% content_for :title, "Upcoming Events Near You" %>

<div class="container my-4" style="max-width: 540px;">
  <% @events.upcoming.each do |event| %>
    <% venue = event.venue %>
    <% artist = event.artist %>

    <div class="card mb-4 shadow border-0 position-relative"
         data-controller="event-card"
         data-event-card-url-value="<%= event_path(event) %>"
         data-action="click->event-card#goToEvent">

      <div class="card-body position-relative pe-5">
        <!-- artist image and name -->
        <% if artist&.image&.attached? %>
          <div style="position: absolute; top: 12px; right: 12px; width: 100px; text-align: center; z-index: 1;">
            <%= link_to artist_path(artist), data: { turbo_frame: "_top" } do %>
              <%= image_tag artist.image.variant(resize_to_fill: [80, 80]),
                    class: "rounded-circle shadow",
                    style: "object-fit: cover;" %>
            <% end %>

            <div class="mt-1 text-muted small fw-semibold">
              <%= link_to artist.username, artist_path(artist),
                    class: "text-decoration-none text-reset",
                    data: { turbo_frame: "_top" } %>
            </div>

            <div class="mt-1 text-muted small fw-normal mb-3">
              <%= event.category %>
            </div>
          </div>
        <% end %>

        <!-- venue -->
        <div class="mb-2 position-relative" style="z-index: 2;">
          <p class="mb-0">
            <%= link_to venue.name, venue_path(venue),
                  class: "fw-bold fs-5 text-decoration-none text-primary",
                  data: { turbo_frame: "_top" } %>
          </p>
        </div>

        <!-- date time -->
        <div class="mt-3 mb-3">
          <p class="mb-0 text-muted small fw-semibold">
            <%= event.date.strftime("%A, %B %-d") %><br>
            <%= event.start_time.strftime("%-I:%M %p") %> â€“ <%= event.end_time.strftime("%-I:%M %p") %>
          </p>
        </div>

        <!-- map -->
        <% if venue.latitude.present? && venue.longitude.present? %>
          <div class="position-relative" style="z-index: 2;">
            <%= link_to "Map",
                "/map?lat=#{venue.latitude}&lng=#{venue.longitude}&venue_id=#{venue.id}",
                class: "btn btn-sm btn-outline-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
