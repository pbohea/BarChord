<% content_for :title, "Upcoming Events Near You" %>

<div id="events" class="row g-4">
  <% @events.each do |event| %>
    <% venue = event.venue %>
    <div class="col-12">
      <div class="card shadow-sm mb-1">
        <% if venue.image.attached? %>
          <%= image_tag venue.image.variant(resize_to_fill: [1200, 300]), class: "card-img-top" %>
        <% end %>

        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h5 class="card-title mb-1">
                <%= link_to venue.name, venue_path(venue), class: "text-decoration-none" %>
              </h5>
              <p class="text-muted mb-0"><small><%= event.category %></small></p>
            </div>

            <% if event.artist.present? %>
              <%= link_to event.artist.username, artist_path(event.artist), class: "badge bg-primary text-decoration-none" %>
            <% else %>
              <span class="badge bg-secondary"><%= event.artist_name %></span>
            <% end %>
          </div>

          <p class="card-text mb-2">
            <%= link_to venue.full_address, "https://www.google.com/maps/search/?api=1&query=#{CGI.escape(venue.full_address)}", target: "_blank", class: "text-decoration-none" %><br>
            <strong>
              <%= event.date == Date.today ? "Today" : event.date.strftime("%B %-d") %>
              &middot;
              <%= event.start_time.strftime("%l:%M %p") %> - <%= event.end_time.strftime("%l:%M %p") %>
            </strong>
          </p>

          <%= link_to "View Event", event_path(event), class: "btn btn-outline-primary btn-sm" %>
        </div>
      </div>
    </div>
  <% end %>
</div>
