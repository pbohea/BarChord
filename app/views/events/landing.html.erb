<% content_for :title, "Find Live Music Events" %>

<div class="container my-5" style="max-width: 540px;">
  <div class="card shadow-sm border-0">
    <div class="card-body p-4">
      <h2 class="h5 text-center mb-4">Find live music events</h2>

      <%= form_with url: events_path, method: :get, local: true, 
                    data: { 
                      controller: "location-search",
                      action: "submit->location-search#validateLocation"
                    } do |f| %>

        <!-- Address and Radius Row -->
        <div class="row g-2 mb-3">
          <div class="col-8">
            <%= f.text_field :address, 
                placeholder: "Enter address or ZIP code", 
                class: "form-control form-control-sm",
                required: true,
                data: { "location-search-target": "addressInput" } %>
          </div>
          <div class="col-4">
            <%= f.select :radius, 
                options_for_select([
                  ['1 mi', 1], ['5 mi', 5], ['10 mi', 10], 
                  ['15 mi', 15], ['25 mi', 25], ['50 mi', 50]
                ], 5),
                {}, 
                { class: "form-select form-select-sm" } %>
          </div>
        </div>

        <!-- Date Range Row -->
        <div class="mb-3">
          <%= f.label :date_range, "Show events for", class: "form-label small text-muted" %>
          <%= f.select :date_range,
                options_for_select([
                  ["Any Date", ""],
                  ["Today", "today"],
                  ["Next 7 Days", "next_7_days"]
                ]),
                {}, 
                { class: "form-select form-select-sm" } %>
        </div>

        <!-- Error message container -->
        <div id="location-error" class="alert alert-danger d-none mb-3" role="alert">
          Please enter an address or use your current location before searching.
        </div>

        <!-- Buttons -->
        <div class="d-grid gap-2">
          <%= f.submit "Search Events", class: "btn btn-primary btn-sm" %>
          <button type="button" 
                  class="btn btn-outline-secondary btn-sm"
                  data-action="click->location-search#useCurrentLocation">
            <i class="bi bi-crosshair"></i> Use My Location
          </button>
        </div>

        <!-- Hidden fields for coordinates -->
        <%= f.hidden_field :lat, data: { "location-search-target": "latInput" } %>
        <%= f.hidden_field :lng, data: { "location-search-target": "lngInput" } %>
      <% end %>
    </div>
  </div>
</div>
