<% content_for :title, "Find Live Music Near You" %>

<div class="container my-5" style="max-width: 540px;">
  <div class="card shadow-sm border-0">
    <div class="card-body p-4">

      <h2 class="h5 text-center mb-3">Find events near you</h2>

      <%= form_with url: events_map_path, method: :get, local: true,
          data: {
            controller: "location-search",
            "location-search-current-lat-value": params[:lat],
            "location-search-current-lng-value": params[:lng],
            "location-search-current-address-value": params[:address],
            "location-search-current-radius-value": params[:radius] || 5
          } do |f| %>

        <div class="mb-3">
          <%= f.label :address, "Address or ZIP code", class: "form-label small text-muted" %>
          <%= f.text_field :address,
                class: "form-control form-control-sm",
                placeholder: "e.g. 60614 or Chicago",
                value: params[:address],
                data: { "location-search-target": "addressInput" } %>
        </div>

        <div class="mb-3">
          <%= f.label :radius, "Search Radius", class: "form-label small text-muted" %>
          <%= f.select :radius,
                options_for_select([
                  ['1 mi', 1], ['5 mi', 5], ['10 mi', 10],
                  ['15 mi', 15], ['25 mi', 25], ['50 mi', 50]
                ], params[:radius] || 5),
                {}, class: "form-select form-select-sm" %>
        </div>

        <div class="mb-3">
          <%= f.label :date_range, "Show events for", class: "form-label" %>
          <%= f.select :date_range,
        options_for_select([
          ["Any Date", ""],
          ["Today", "today"],
          ["Next 7 Days", "next_7_days"]
        ], params[:date_range]),
        {}, class: "form-select form-select-sm" %>
        </div>

        <div class="d-grid gap-2 mb-2">
          <%= f.submit "Show Map", class: "btn btn-primary btn-sm" %>
          <button type="button"
                  class="btn btn-outline-secondary btn-sm"
                  data-action="click->location-search#useCurrentLocation">
            <i class="bi bi-crosshair"></i> Use My Location
          </button>
        </div>

        <%= f.hidden_field :lat, data: { "location-search-target": "latInput" } %>
        <%= f.hidden_field :lng, data: { "location-search-target": "lngInput" } %>
      <% end %>

    </div>
  </div>
</div>
