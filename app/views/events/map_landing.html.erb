<% content_for :title, "Find Live Music Near You" %>

<div class="min-vh-100 bg-light">
  <div class="container py-5" style="max-width: 600px;">

    <div class="card border-0 shadow-lg rounded-4 text-center">
      <div class="card-body p-4">
        <h5 class="fw-semibold mb-3">Find Live Music on the Map</h5>
        <p class="text-muted small">Search by address or current location and view results on the map.</p>

        <%= form_with url: events_map_path, method: :get, local: true,
            data: {
              controller: "location-search",
              "location-search-current-lat-value": params[:lat],
              "location-search-current-lng-value": params[:lng],
              "location-search-current-address-value": params[:address],
              "location-search-current-radius-value": params[:radius] || 5
            } do |f| %>

          <!-- Location Options -->
          <div class="mb-3 text-start">
            <label class="form-label small text-muted">Location</label>

            <div class="form-check mb-2">
              <%= radio_button_tag :location_type, "address", true,
                    class: "form-check-input",
                    data: { "location-search-target": "addressRadio" } %>
              <%= label_tag :location_type_address, "Enter address", class: "form-check-label" %>
            </div>

            <%= f.text_field :address,
                  placeholder: "Enter address or ZIP code",
                  class: "form-control",
                  value: params[:address],
                  data: { "location-search-target": "addressInput" } %>

            <div class="form-check mt-2">
              <%= radio_button_tag :location_type, "current", false,
                    class: "form-check-input",
                    data: { "location-search-target": "currentRadio", action: "change->location-search#getCurrentLocation" } %>
              <%= label_tag :location_type_current, "Use my current location", class: "form-check-label" %>
            </div>
          </div>

          <!-- Search Radius -->
          <div class="mb-3 text-start">
            <%= f.label :radius, "Search Radius", class: "form-label small text-muted" %>
            <%= f.select :radius,
                  options_for_select([
                    ['1 mi', 1], ['5 mi', 5], ['10 mi', 10],
                    ['15 mi', 15], ['25 mi', 25], ['50 mi', 50]
                  ], params[:radius] || 5),
                  {}, class: "form-select" %>
          </div>

          <!-- Date Range -->
          <div class="mb-3 text-start">
            <%= f.label :date_range, "Show events for", class: "form-label small text-muted" %>
            <%= f.select :date_range,
                  options_for_select([
                    ["Any Date", ""],
                    ["Today", "today"],
                    ["Next 7 Days", "next_7_days"]
                  ], params[:date_range]),
                  {}, class: "form-select" %>
          </div>

          <!-- Error message -->
          <div id="location-error" class="alert alert-danger d-none mb-3" role="alert">
            Please enter an address or use your current location before searching.
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary w-100 rounded-pill shadow-sm">
            Show Map
          </button>

          <%= f.hidden_field :lat, data: { "location-search-target": "latInput" } %>
          <%= f.hidden_field :lng, data: { "location-search-target": "lngInput" } %>
        <% end %>
      </div>
    </div>

  </div>
</div>
