<% content_for :title, "Event Information" %>

<div class="container mb-3 pt-3" style="max-width: 500px;">
  <div class="card shadow-sm border-0">
    <div class="card-body text-center py-4">

      <!-- Venue Name at Top -->
      <h5 class="text-primary fw-bold mb-3">
        <%= link_to @event.venue.name, 
              venue_path(@event.venue), 
              class: "text-decoration-none text-primary" %>
      </h5>

      <!-- Artist Image -->
      <% if @event.artist&.image&.attached? %>
        <%= link_to artist_path(@event.artist), data: { turbo_frame: "_top" } do %>
          <%= image_tag @event.artist.image.variant(resize_to_fill: [100, 100]),
                class: "rounded-circle mb-3 shadow",
                style: "object-fit: cover;" %>
        <% end %>
      <% else %>
        <div class="rounded-circle bg-secondary mb-3 d-flex align-items-center justify-content-center mx-auto shadow" style="width: 100px; height: 100px; color: white;">
          <i class="fas fa-user fa-2x"></i>
        </div>
      <% end %>

      <!-- Artist Name -->
      <h6 class="mb-2">
        <%= link_to @event.artist.username, artist_path(@event.artist),
              class: "text-decoration-none text-dark fw-semibold",
              data: { turbo_frame: "_top" } %>
      </h6>

      <!-- Category/Description -->
      <p class="text-muted mb-0">
        <%= @event.description.presence || @event.category %>
      </p>
    </div>

    <!-- Event Details -->
    <div class="card-body pt-0">
      <div class="row g-3">
        <!-- Date & Time -->
        <div class="col-12">
          <div class="d-flex align-items-center">
            <i class="bi bi-calendar3 text-primary me-3"></i>
            <div>
              <div class="fw-semibold"><%= @event.date.strftime("%A, %B %-d") %></div>
              <small class="text-muted">
                <%= @event.start_time.strftime("%-I:%M %p") %> â€“ <%= @event.end_time.strftime("%-I:%M %p") %>
              </small>
            </div>
          </div>
        </div>

        <!-- Location -->
        <div class="col-12">
          <div class="d-flex align-items-center">
            <i class="bi bi-<%= @event.indoors? ? 'house' : 'cloud-sun' %> text-primary me-3"></i>
            <div>
              <div class="fw-semibold"><%= @event.indoors? ? "Indoors" : "Outdoors" %></div>
            </div>
          </div>
        </div>

        <!-- Cover Charge -->
        <div class="col-12">
          <div class="d-flex align-items-center">
            <i class="bi bi-credit-card text-primary me-3"></i>
            <div>
              <div class="fw-semibold">
                <%= @event.cover? ? "Cover: #{number_to_currency(@event.cover_amount || 5)}" : "No Cover" %>
              </div>
            </div>
          </div>
        </div>

        <!-- Map Button -->
        <% if @event.venue.latitude.present? && @event.venue.longitude.present? %>
          <div class="col-12">
            <div class="d-flex align-items-center">
              <i class="bi bi-geo-alt text-primary me-3"></i>
              <div class="flex-grow-1">
                <!-- Mobile Native App Button -->
                <div class="d-block d-md-none">
                  <%= link_to "Show on Map",
                      "/events/map?lat=#{@event.venue.latitude}&lng=#{@event.venue.longitude}&venue_id=#{@event.venue.id}",
                      class: "btn btn-sm btn-outline-primary",
                      data: { turbo_frame: "_top" } %>
                </div>

                <!-- Web/Desktop Google Maps Button -->
                <div class="d-none d-md-block">
                  <%= link_to "Open in Google Maps",
                      "https://www.google.com/maps/search/#{CGI.escape(@event.venue.name)}/@#{@event.venue.latitude},#{@event.venue.longitude},17z",
                      class: "btn btn-sm btn-outline-primary",
                      target: "_blank",
                      rel: "noopener noreferrer" %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Edit/Delete Actions -->
  <% if can_modify_event?(@event) %>
    <div class="mt-4 d-flex gap-2 justify-content-center">
      <%= link_to "Edit Event", 
        edit_event_path(@event), 
        class: "btn btn-warning" %>

      <%= button_to "Cancel Event", 
        event_path(@event), 
        method: :delete, 
        class: "btn btn-danger",
        data: { confirm: "Are you sure you want to cancel this event? This action cannot be undone." },
        form: { class: "d-inline" } %>
    </div>
  <% end %>
</div>
