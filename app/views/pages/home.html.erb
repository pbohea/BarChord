
<% content_for :title, "BarChord" %>

<div class="min-vh-100 bg-light">
  <div class="container py-4" style="max-width: 600px;" data-controller="home-search">

    <!-- Hero Section -->
    <div class="text-center mb-2">
      <div class="mb-1">
        <img src="/logoplain.png" alt="Logo" class="mb-0" width="64" height="84">
      </div>
      <h1 class="h3 fw-bold mb-2">Welcome to BarChord</h1>
      <p class="text-muted mb-4">Find small time live music at a bar or restaurant near you</p>
    </div>

    <!-- Main Search Card -->
    <div class="bg-white p-4 rounded-4 shadow-sm mb-4">
      <%= form_with url: events_path, method: :get, local: true,
                    data: {
                      controller: "location-search",
                      action: "submit->location-search#validateLocation"
                    } do |f| %>

        <!-- Location Section -->
        <div class="mb-4">
          <h6 class="fw-semibold mb-3 d-flex align-items-center">
            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
            Location
          </h6>

          <!-- Address Option -->
          <div class="form-check mb-3 p-3 rounded-3 border border-light-subtle">
            <%= radio_button_tag :location_type, "address", true,
                  class: "form-check-input",
                  data: { "location-search-target": "addressRadio" } %>
            <%= label_tag :location_type_address, class: "form-check-label fw-medium ms-2" do %>
              <i class="fas fa-search me-2"></i>Enter address
            <% end %>
            
            <%= f.text_field :address,
                  placeholder: "Enter address or ZIP code",
                  class: "form-control mt-2 border-0 bg-light",
                  required: true,
                  data: { "location-search-target": "addressInput" } %>
          </div>

          <!-- Current Location Option -->
          <div class="form-check p-3 rounded-3 border border-light-subtle">
            <%= radio_button_tag :location_type, "current", false,
                  class: "form-check-input",
                  data: { "location-search-target": "currentRadio", action: "change->location-search#getCurrentLocation" } %>
            <%= label_tag :location_type_current, class: "form-check-label fw-medium ms-2" do %>
              <i class="fas fa-crosshairs me-2"></i>Use my current location
            <% end %>
          </div>
        </div>

        <!-- Filters Section -->
        <div class="row g-3 mb-4">
          <!-- Search Radius -->
          <div class="col-sm-6">
            <h6 class="fw-semibold mb-2 d-flex align-items-center">
              <i class="fas fa-expand-arrows-alt me-2 text-success"></i>
              <span class="small">Search Radius</span>
            </h6>
            <%= f.select :radius,
                  options_for_select([
                    ['1 mi', 1], ['5 mi', 5], ['10 mi', 10]
                  ], 1),
                  {}, class: "form-select border-0 bg-light" %>
          </div>

          <!-- Date Range -->
          <div class="col-sm-6">
            <h6 class="fw-semibold mb-2 d-flex align-items-center">
              <i class="fas fa-calendar-alt me-2 text-warning"></i>
              <span class="small">Time Period</span>
            </h6>
            <%= f.select :date_range,
                  options_for_select([
                    ["Any Date", ""],
                    ["Today", "today"],
                    ["Next 7 Days", "next_7_days"]
                  ]),
                  {}, class: "form-select border-0 bg-light" %>
          </div>
        </div>

        <!-- Error Message -->
        <div id="location-error" class="alert alert-danger d-none mb-3 border-0 rounded-3" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Please enter an address or use your current location before searching.
        </div>

        <!-- Submit Button -->
        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg shadow-sm" style="border-radius: 50px;">
            <i class="fas fa-search me-2"></i>
            Search Events
          </button>
        </div>

        <%= f.hidden_field :lat, data: { "location-search-target": "latInput" } %>
        <%= f.hidden_field :lng, data: { "location-search-target": "lngInput" } %>
      <% end %>
    </div>

    <!-- OR Divider -->
    <div class="text-center mb-4">
      <div class="d-flex align-items-center">
        <hr class="flex-grow-1">
        <span class="px-3 text-muted small">OR</span>
        <hr class="flex-grow-1">
      </div>
    </div>

    <!-- Quick Search Section -->
    <div class="card border-0 shadow-sm mb-4 rounded-3">
      <div class="card-body p-3">
        <h6 class="fw-semibold mb-3 d-flex align-items-center">
          <i class="fas fa-search me-2 text-primary"></i>
          Search your favorite bars & bands
        </h6>

        <!-- Venue Search -->
        <div class="mb-3" data-home-search-target="venueCard">
          <div data-controller="venue-autocomplete" class="position-relative">
            <input type="text"
             class="form-control pe-5 border-0 bg-light"
             placeholder="Search venues..."
             data-venue-autocomplete-target="input"
             data-action="input->venue-autocomplete#search"
            data-home-search-target="venueInput" />

            <button type="button"
              class="btn btn-sm position-absolute top-50 translate-middle-y end-0 me-2 text-muted"
              style="z-index: 10;"
              aria-label="Clear venue"
              data-action="home-search#clearVenue">
              &times;
            </button>

            <input type="hidden"
             data-venue-autocomplete-target="hidden"
             data-home-search-target="venueHidden"
             data-action="change->home-search#updateState">

            <ul class="list-group small mt-2"
          data-venue-autocomplete-target="results"
          style="border-radius: 0.5rem;"></ul>
          </div>

          <button type="button"
            class="btn btn-primary w-100 mt-2 rounded-pill d-none"
            data-home-search-target="venueButton"
            data-action="home-search#goToVenue">
            Go to Venue
          </button>
        </div>

        <!-- Artist Search -->
        <div data-home-search-target="artistCard">
          <div data-controller="artist-autocomplete" class="position-relative">
            <input type="text"
             class="form-control pe-5 border-0 bg-light"
             placeholder="Search artists..."
             data-artist-autocomplete-target="input"
             data-action="input->artist-autocomplete#search"
            data-home-search-target="artistInput" />

            <button type="button"
              class="btn btn-sm position-absolute top-50 translate-middle-y end-0 me-2 text-muted"
              style="z-index: 10;"
              aria-label="Clear artist"
              data-action="home-search#clearArtist">
              &times;
            </button>

            <input type="hidden"
             data-artist-autocomplete-target="hidden"
             data-home-search-target="artistHidden"
             data-action="change->home-search#updateState">

            <ul class="list-group small mt-2"
          data-artist-autocomplete-target="results"
          style="border-radius: 0.5rem;"></ul>
          </div>

          <button type="button"
            class="btn btn-primary w-100 mt-2 rounded-pill d-none"
            data-home-search-target="artistButton"
            data-action="home-search#goToArtist">
            Go to Artist
          </button>
        </div>
      </div>
    </div>

  </div>
</div>
